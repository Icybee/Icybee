String.implement({shorten:function(e,t){void 0===e&&(e=32),void 0===t&&(t=.75);var n=this.length;return e>=n?this:(e--,t=Math.round(t*e),0==t?"…"+this.substring(n-e):t==e?this.substring(0,e)+"…":this.substring(0,t)+"…"+this.substring(n-(e-t)))}}),Request.API&&(Request.Element=new Class({Extends:Request.API,onSuccess:function(e,t){var n=Elements.from(e.rc).shift();return e.assets?void Brickrouge.updateAssets(e.assets,function(){this.fireEvent("complete",[e,t]).fireEvent("success",[n,e,t]).callChain()}.bind(this)):void this.parent(n,e,t)}}),Request.Widget=new Class({Extends:Request.Element,initialize:function(e,t,n){void 0==n&&(n={}),n.url="widgets/"+e,n.onSuccess=t,this.parent(n)}})),document.body.addEvent('click:relay(.group-toggler input[type="checkbox"])',function(e,t){var n=t.getParent(".group-toggler");n[t.checked?"addClass":"removeClass"]("enabled")}),!function(){var e=null,t=null,n=null,i=null;ICanBoogie.XHR.NOTICE_DELAY=1e3,window.addEvent("icanboogie.xhr.shownotice",function(){e||(e=new Element("div.xhr-dummy"),n=new Element("div.xhr-message"),t=new Fx.Tween(e,{property:"opacity",duration:"short",link:"cancel"}),t.set(0),i=new Fx.Tween(n,{property:"opacity",duration:"short",link:"cancel"}),i.set(0)),document.body.appendChild(e),document.body.appendChild(n),t.start(1),i.start(1)}),window.addEvent("icanboogie.xhr.hidenotice",function(){e&&e.getParent()&&(i.start(0),t.start(0).chain(function(){e.dispose(),n.dispose()}))})}(),!function(e){e.Widget.ActionBar=new Class({Implements:[Events],initialize:function(e){this.element=e=document.id(e),this.setUpAnchoring(),e.addEvent("click:relay([data-target])",function(e){var t=document.id(document.body).getElement(e.target.get("data-target"));t&&"FORM"==t.tagName&&t.submit()}),this.fireEvent("icybee.actionbar.ready",this)},toElement:function(){return this.element},setUpAnchoring:function(){function e(){var e=document.html.scrollTop||document.body.scrollTop;t[e>n?"addClass":"removeClass"]("fixed")}var t=this.element,n=t.getPosition().y;window.addEvents({load:e,resize:e,scroll:e})},changeContext:function(e){this.element.set("data-context",e||"")}}),e.register("action-bar",function(t,n){return new e.Widget.ActionBar(t,n)})}(Brickrouge),Brickrouge.observe("update",function(e){e.getElements("textarea.code").each(function(e){e.spellcheck&&(e.spellcheck=!1)})}),window.addEvent("domready",function(){function e(e){var t=[],n=[],i={};e.getElements("[name]").each(function(e){if(!e.disabled){var o=e.get("name"),s=e.get("value");t.push(o),n.push(s),i[o]=s}});var o=t.slice(0),s={};o.sort();for(var r=0;r<o.length;r++){var a=o[r];s[a]=i[a]}var c=new Hash(s);return c.toQueryString()}var t=null,n=!1,i=document.body.getElement(".form-primary");i&&(t=e(i),window.addEvent("load",function(){t=e(i)}),window.onbeforeunload=function(){if(n)return void(n=!1);var o=e(i);if(t!=o)return"Des changements ont été fait sur la page. Si vous changez de page maintenant, ils seront perdus."},i.addEvent("submit",function(o){n=!0,t=e(i)}))}),!function(){var e=new Class({initialize:function(e,t){this.src=t,this.element=document.id(e),this.element.addEvents({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)})},onMouseEnter:function(){this.cancel=!1,(this.popover?this.show:this.load).delay(this.element.get("data-popover-delay")||100,this)},onMouseLeave:function(){this.cancel=!0,this.hide()},load:function(){this.cancel||this.popover||new Asset.image(this.src,{onload:function(e){var t,n=this.element.get("data-popover-target"),i=this.element;return n&&(i=this.element.getParent(n)||i),t=i.getCoordinates(),e.id="popover-image",e.setStyles({top:t.top+(t.height-e.height)/2-2,left:t.left+t.width+20,opacity:0}),e.set("tween",{duration:"short",link:"cancel"}),e.addEvent("mouseenter",this.onMouseLeave.bind(this)),this.popover?void e.destroy():(this.popover=e,void this.show())}.bind(this)})},show:function(){if(!this.cancel){var e=this.popover;document.body.appendChild(e),e.fade("in")}},hide:function(){var e=this.popover;e&&e.getParent()&&(this.popover=null,e.get("tween").start("opacity",0).chain(function(){document.body.removeChild(e)}))}}),t=[];document.body.addEvent("mouseenter:relay([data-popover-image])",function(n,i){var o,s=i.uniqueNumber;t[s]||(o=new e(i,i.get("data-popover-image")),o.load(),t[s]=o)})}(),Brickrouge.observe("running",function(){var e=document.body.querySelector(".actionbar .record-save-mode"),t=document.body.querySelector(".form-actions .save-mode"),n=t?t.querySelectorAll('input[type="radio"]'):[],i=document.body.querySelector(".form-actions .btn-primary");e&&n.length&&(e.addEventListener("click",function(e){var t=e.target,o=t.getAttribute("data-key");return t.match(".btn-primary:first-child")?(e.preventDefault(),void i.click()):void(o&&(e.preventDefault(),Array.prototype.forEach.call(n,function(e){e.checked=e.value===o}),i.click()))}),t.addDelegatedEventListener('[type="radio"]',"click",function(t,n){var i=n.value;Array.prototype.forEach.call(e.querySelectorAll(".dropdown-item"),function(t){var n=t.getAttribute("data-key");i===n?(t.classList.add("active"),e.querySelector(".btn").innerHTML=t.innerHTML):t.classList.remove("active")})}))}),!function(e){e.Widget.Spinner=new Class({Implements:[Options,Events],initialize:function(e,t){this.element=e=document.id(e),this.setOptions(t),this.control=e.getElement("input"),this.content=e.getElement(".spinner-content"),this.popover=null,this.resetValue=null,this.resetContent=null,e.addEvent("click",function(e){e.stop(),this.open()}.bind(this))},open:function(){},setValue:function(e){if(this.content){var t=this.formatValue(e),n=typeOf(t);this.content.empty(),"element"==n||"elements"==n?this.content.adopt(t):"string"==n&&(this.content.innerHTML=t)}this.element[e?"removeClass":"addClass"]("placeholder"),this.control.set("value",this.encodeValue(e))},getValue:function(){return this.decodeValue(this.control.get("value"))},encodeValue:function(e){return e},decodeValue:function(e){return e},formatValue:function(e){return e},attachAdjust:function(e){}}),e.register("spinner",function(t,n){return new e.Widget.Spinner(t,n)})}(Brickrouge),this.Icybee={Widget:{AdjustPopover:new Class({Extends:Brickrouge.Popover,Implements:[Options,Events],initialize:function(e,t){this.parent(e,t),this.adjust=null,this.selected=null},getAdjust:function(){return Brickrouge.from(this.element.getElement(".popover-content :first-child"))},show:function(){this.parent(),this.adjust=this.getAdjust(),this.adjust&&(this.adjust.addEvent("results",this.repositionCallback),this.adjust.addEvent("adjust",this.quickRepositionCallback))}})}};
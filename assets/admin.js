String.implement({shorten:function(e,t){void 0===e&&(e=32),void 0===t&&(t=.75);var n=this.length;return e>=n?this:(e--,t=Math.round(t*e),0==t?"…"+this.substring(n-e):t==e?this.substring(0,e)+"…":this.substring(0,t)+"…"+this.substring(n-(e-t)))}}),document.body.addEvent('click:relay(.group-toggler input[type="checkbox"])',function(e,t){var n=t.getParent(".group-toggler");n[t.checked?"addClass":"removeClass"]("enabled")}),!function(){var e=null,t=null,n=null,i=null;ICanBoogie.XHR.NOTICE_DELAY=1e3,window.addEvent("icanboogie.xhr.shownotice",function(){e||(e=new Element("div.xhr-dummy"),n=new Element("div.xhr-message"),t=new Fx.Tween(e,{property:"opacity",duration:"short",link:"cancel"}),t.set(0),i=new Fx.Tween(n,{property:"opacity",duration:"short",link:"cancel"}),i.set(0)),document.body.appendChild(e),document.body.appendChild(n),t.start(1),i.start(1)}),window.addEvent("icanboogie.xhr.hidenotice",function(){e&&e.getParent()&&(i.start(0),t.start(0).chain(function(){e.dispose(),n.dispose()}))})}(),Brickrouge.Widget.ActionBar=new Class({Implements:[Events],initialize:function(e){this.element=e=document.id(e),this.setUpAnchoring(),e.addEvent("click:relay([data-target])",function(e){var t=document.id(document.body).getElement(e.target.get("data-target"));t&&"FORM"==t.tagName&&t.submit()}),this.fireEvent("icybee.actionbar.ready",this)},toElement:function(){return this.element},setUpAnchoring:function(){function e(){var e=document.html.scrollTop||document.body.scrollTop;t[e>n?"addClass":"removeClass"]("fixed")}var t=this.element,n=t.getPosition().y;window.addEvents({load:e,resize:e,scroll:e})},changeContext:function(e){this.element.set("data-context",e||"")}}),window.addEvent("brickrouge.update",function(e){e.getElements("textarea.code").each(function(e){e.spellcheck&&(e.spellcheck=!1)})}),window.addEvent("domready",function(){function e(e){var t=[],n=[],i={};e.getElements("[name]").each(function(e){if(!e.disabled){var o=e.get("name"),a=e.get("value");t.push(o),n.push(a),i[o]=a}});var o=t.slice(0),a={};o.sort();for(var s=0;s<o.length;s++){var d=o[s];a[d]=i[d]}var r=new Hash(a);return r.toQueryString()}var t=null,n=!1,i=document.body.getElement(".form-primary");i&&(t=e(i),window.addEvent("load",function(){t=e(i)}),window.onbeforeunload=function(){if(n)return void(n=!1);var o=e(i);if(t!=o)return"Des changements ont été fait sur la page. Si vous changez de page maintenant, ils seront perdus."},i.addEvent("submit",function(){n=!0,t=e(i)}))}),!function(){var e=new Class({initialize:function(e,t){this.src=t,this.element=document.id(e),this.element.addEvents({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)})},onMouseEnter:function(){this.cancel=!1,(this.popover?this.show:this.load).delay(this.element.get("data-popover-delay")||100,this)},onMouseLeave:function(){this.cancel=!0,this.hide()},load:function(){this.cancel||this.popover||new Asset.image(this.src,{onload:function(e){var t,n=this.element.get("data-popover-target"),i=this.element;return n&&(i=this.element.getParent(n)||i),t=i.getCoordinates(),e.id="popover-image",e.setStyles({top:t.top+(t.height-e.height)/2-2,left:t.left+t.width+20,opacity:0}),e.set("tween",{duration:"short",link:"cancel"}),e.addEvent("mouseenter",this.onMouseLeave.bind(this)),this.popover?void e.destroy():(this.popover=e,void this.show())}.bind(this)})},show:function(){if(!this.cancel){var e=this.popover;document.body.appendChild(e),e.fade("in")}},hide:function(){var e=this.popover;e&&e.getParent()&&(this.popover=null,e.get("tween").start("opacity",0).chain(function(){document.body.removeChild(e)}))}}),t=[];document.body.addEvent("mouseenter:relay([data-popover-image])",function(n,i){var o,a=i.uniqueNumber;t[a]||(o=new e(i,i.get("data-popover-image")),o.load(),t[a]=o)})}(),!function(){function e(e){var t=e.retrieve("target");t.set("value",t.get("data-default-value")),t.fireEvent("change"),e.addClass("hidden")}var t=[];document.body.addEvent("click:relay(.reset-default-value)",function(t,n){e(n)}),document.body.addEvent("keypress:relay(.reset-default-value)",function(t,n){("enter"==t.key||"space"==t.key)&&e(n)}),window.addEvent("brickrouge.update",function(e){e.getElements("[data-default-value]").each(function(e){if(-1===t.indexOf(e)){t.push(e);var n=new Element('span.btn.btn-warning.reset-default-value[tabindex="0"]',{html:'<i class="icon-edit icon-white"></i> Reset'}),i=e.getParent(".controls");n.store("target",e),e.get("value")==e.get("data-default-value")&&n.addClass("hidden"),e.addEvent("change",function(){n[this.get("value")==this.get("data-default-value")?"addClass":"removeClass"]("hidden")}),i?n.inject(i):n.inject(e,"after")}})})}(),window.addEvent("domready",function(){var e=document.body.getElement(".actionbar .record-save-mode"),t=document.body.getElement(".form-actions .save-mode"),n=t?t.getElements('input[type="radio"]'):[],i=document.body.getElement(".form-actions .btn-primary");e&&n&&(e.addEvent("click",function(e){var t=e.target,o=t.get("data-key");return t.match(".btn-primary:first-child")?(e.stop(),void i.click()):void(o&&(e.stop(),n.each(function(e){e.checked=e.value==o}),i.click()))}),t.addEvent("click",function(t){var n=t.target.get("value");n&&e.getElements("li").each(function(t){var i=t.getElement("a"),o=i.get("data-key");n==o?(t.addClass("active"),e.getElement(".btn").set("html",i.get("html"))):t.removeClass("active")})}))}),Brickrouge.Widget.Spinner=new Class({Implements:[Options,Events],initialize:function(e,t){this.element=e=document.id(e),this.setOptions(t),this.control=e.getElement("input"),this.content=e.getElement(".spinner-content"),this.popover=null,this.resetValue=null,this.resetContent=null,e.addEvent("click",function(e){e.stop(),this.open()}.bind(this))},open:function(){},setValue:function(e){if(this.content){var t=this.formatValue(e),n=typeOf(t);this.content.empty(),"element"==n||"elements"==n?this.content.adopt(t):"string"==n&&(this.content.innerHTML=t)}this.element[e?"removeClass":"addClass"]("placeholder"),this.control.set("value",this.encodeValue(e))},getValue:function(){return this.decodeValue(this.control.get("value"))},encodeValue:function(e){return e},decodeValue:function(e){return e},formatValue:function(e){return e},attachAdjust:function(){}}),this.Icybee={Widget:{AdjustPopover:new Class({Extends:Brickrouge.Popover,Implements:[Options,Events],initialize:function(e,t){this.parent(e,t),this.adjust=null,this.selected=null},getAdjust:function(){return this.element.getElement(".popover-content :first-child").get("widget")},show:function(){this.parent(),this.adjust=this.getAdjust(),this.adjust&&(this.adjust.addEvent("results",this.repositionCallback),this.adjust.addEvent("adjust",this.quickRepositionCallback))}})}};
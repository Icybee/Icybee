String.implement({shorten:function(a,b){void 0===a&&(a=32),void 0===b&&(b=.75);var c=this.length;return a>=c?this:(a--,b=Math.round(b*a),0==b?"…"+this.substring(c-a):b==a?this.substring(0,a)+"…":this.substring(0,b)+"…"+this.substring(c-(a-b)))}}),window.addEvent('click:relay(.group-toggler input[type="checkbox"])',function(a,b){var c=b.getParent(".group-toggler");c[b.checked?"addClass":"removeClass"]("enabled")}),!function(){var a=null,b=null,c=null,d=null;ICanBoogie.XHR.NOTICE_DELAY=1e3,window.addEvent("icanboogie.xhr.shownotice",function(){a||(a=new Element("div.xhr-dummy"),c=new Element("div.xhr-message"),b=new Fx.Tween(a,{property:"opacity",duration:"short",link:"cancel"}),b.set(0),d=new Fx.Tween(c,{property:"opacity",duration:"short",link:"cancel"}),d.set(0)),document.body.appendChild(a),document.body.appendChild(c),b.start(1),d.start(1)}),window.addEvent("icanboogie.xhr.hidenotice",function(){a&&a.getParent()&&(d.start(0),b.start(0).chain(function(){a.dispose(),c.dispose()}))})}(),!function(){var a=new Class({initialize:function(a){this.element=a=document.id(a),this.faces=a.getElement(".actionbar-faces"),this.setUpAnchoring(),a.addEvent("click:relay([data-target])",function(a){var b=document.id(document.body).getElement(a.target.get("data-target"));b&&"FORM"==b.tagName&&b.submit()})},toElement:function(){return this.element},setUpAnchoring:function(){function c(){var c=document.html.scrollTop||document.body.scrollTop;a[c>b?"addClass":"removeClass"]("fixed")}var a=this.element,b=a.getPosition().y;window.addEvents({load:c,resize:c,scroll:c})},display:function(a){a?(this.element.set("data-display",a),this.faces.addClass("flipped")):(this.faces.removeClass("flipped"),function(){this.set("data-display","")}.delay(500,this.element))}});window.addEvent("domready",function(){var b=document.body.getElement(".actionbar");b&&(Icybee.actionbar=new a(b))})}(),window.addEvent("brickrouge.update",function(a){a.target.getElements("textarea.code").each(function(a){a.spellcheck&&(a.spellcheck=!1)})}),window.addEvent("domready",function(){function a(a){var b=[],c=[],d={};a.getElements("[name]").each(function(a){if(!a.disabled){var e=a.get("name"),f=a.get("value");b.push(e),c.push(f),d[e]=f}});var e=b.slice(0),f={};e.sort();for(var g=0;g<e.length;g++){var h=e[g];f[h]=d[h]}var i=new Hash(f);return i.toQueryString()}var b=null,c=!1,d=document.body.getElement(".form-primary");d&&(b=a(d),window.addEvent("load",function(){b=a(d)}),window.onbeforeunload=function(){if(c)return c=!1,void 0;var e=a(d);if(b!=e)return"Des changements ont été fait sur la page. Si vous changez de page maintenant, ils seront perdus."},d.addEvent("submit",function(){c=!0,b=a(d)}))}),window.addEvent("click:relay(label.checkbox-wrapper)",function(a,b){var c=a.target;c.getParent()==b&&b[c.checked?"addClass":"removeClass"]("checked")}),window.addEvent("brickrouge.update",function(a){a.target.getElements("label.checkbox-wrapper").each(function(a){var b=a.getElement("input");b.checked&&a.addClass("checked"),b.disabled&&a.addClass("disabled"),b.readonly&&a.addClass("readonly")})}),!function(){var a=new Class({initialize:function(a,b){this.src=b,this.element=document.id(a),this.element.addEvents({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)})},onMouseEnter:function(){this.cancel=!1,(this.popover?this.show:this.load).delay(this.element.get("data-popover-delay")||100,this)},onMouseLeave:function(){this.cancel=!0,this.hide()},load:function(){this.cancel||this.popover||new Asset.image(this.src,{onload:function(a){var d,b=this.element.get("data-popover-target"),c=this.element;return b&&(c=this.element.getParent(b)||c),d=c.getCoordinates(),a.id="popover-image",a.setStyles({top:d.top+(d.height-a.height)/2-2,left:d.left+d.width+20,opacity:0}),a.set("tween",{duration:"short",link:"cancel"}),a.addEvent("mouseenter",this.onMouseLeave.bind(this)),this.popover?(a.destroy(),void 0):(this.popover=a,this.show(),void 0)}.bind(this)})},show:function(){if(!this.cancel){var a=this.popover;document.body.appendChild(a),a.fade("in")}},hide:function(){var a=this.popover;a&&a.getParent()&&(this.popover=null,a.get("tween").start("opacity",0).chain(function(){document.body.removeChild(a),delete a}))}}),b=[];document.body.addEvent("mouseenter:relay([data-popover-image])",function(c,d){var f,e=d.uniqueNumber;b[e]||(f=new a(d,d.get("data-popover-image")),f.load(),b[e]=f)})}(),!function(){function b(a){var b=a.retrieve("target");b.set("value",b.get("data-default-value")),b.fireEvent("change"),a.addClass("hidden")}var a=[];document.body.addEvent("click:relay(.reset-default-value)",function(a,c){b(c)}),document.body.addEvent("keypress:relay(.reset-default-value)",function(a,c){("enter"==a.key||"space"==a.key)&&b(c)}),window.addEvent("brickrouge.update",function(b){b.target.getElements("[data-default-value]").each(function(b){if(-1===a.indexOf(b)){a.push(b);var c=new Element('span.btn.btn-warning.reset-default-value[tabindex="0"]',{html:'<i class="icon-edit icon-white"></i> Reset'}),d=b.getParent(".controls");c.store("target",b),b.get("value")==b.get("data-default-value")&&c.addClass("hidden"),b.addEvent("change",function(){c[this.get("value")==this.get("data-default-value")?"addClass":"removeClass"]("hidden")}),d?c.inject(d):c.inject(b,"after")}})})}(),window.addEvent("domready",function(){var a=document.body.getElement(".actionbar .record-save-mode"),b=document.body.getElement(".form-actions .save-mode"),c=b?b.getElements('input[type="radio"]'):[],d=document.body.getElement(".form-actions .btn-primary");a&&c&&(a.addEvent("click",function(a){var b=a.target,e=b.get("data-key");return b.match(".btn-primary:first-child")?(a.stop(),d.click(),void 0):(e&&(a.stop(),c.each(function(a){a.checked=a.value==e}),d.click()),void 0)}),b.addEvent("click",function(b){var c=b.target.get("value");c&&a.getElements("li").each(function(b){var d=b.getElement("a"),e=d.get("data-key");c==e?(b.addClass("active"),a.getElement(".btn").set("html",d.get("html"))):b.removeClass("active")})}))}),Brickrouge.Widget.Spinner=new Class({Implements:[Options,Events],initialize:function(a,b){this.element=a=document.id(a),this.setOptions(b),this.control=a.getElement("input"),this.content=a.getElement(".spinner-content"),this.popover=null,this.resetValue=null,this.resetContent=null,a.addEvent("click",function(a){a.stop(),this.open()}.bind(this))},open:function(){},setValue:function(a){if(this.content){var b=this.formatValue(a),c=typeOf(b);this.content.empty(),"element"==c||"elements"==c?this.content.adopt(b):"string"==c&&(this.content.innerHTML=b)}this.element[a?"removeClass":"addClass"]("placeholder"),this.control.set("value",this.encodeValue(a))},getValue:function(){return this.decodeValue(this.control.get("value"))},encodeValue:function(a){return a},decodeValue:function(a){return a},formatValue:function(a){return a},attachAdjust:function(){}}),this.Icybee={Widget:{AdjustPopover:new Class({Extends:Brickrouge.Popover,Implements:[Options,Events],initialize:function(a,b){this.parent(a,b),this.adjust=null,this.selected=null},getAdjust:function(){return this.element.getElement(".popover-content :first-child").get("widget")},show:function(){this.parent(),this.adjust=this.getAdjust(),this.adjust&&(this.adjust.addEvent("results",this.repositionCallback),this.adjust.addEvent("adjust",this.quickRepositionCallback))}})}};